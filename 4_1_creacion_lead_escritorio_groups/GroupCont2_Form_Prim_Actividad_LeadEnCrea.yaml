- Rectangle_body_form_defActv_creaLead:
    Control: Rectangle@2.3.0
    Group: GroupCont2_Form_Prim_Actividad_LeadEnCrea
    Properties:
      BorderColor: =RGBA(0, 18, 107, 1)
      Fill: =RGBA(_r_fondo_crema,_g_fondo_crema, _b_fondo_crema, _a_fondo_crema)
      Height: =850
      Visible: =_crearAgenda
      Width: =1510
- Label_act_primAct_creaLead:
    Control: Label@2.5.1
    Group: GroupCont2_Form_Prim_Actividad_LeadEnCrea
    Properties:
      BorderColor: =RGBA(0, 18, 107, 1)
      Color: =RGBA(85, 69, 49, 1)
      Font: =Font.'Open Sans'
      FontWeight: =FontWeight.Semibold
      Height: =30
      Size: =20
      Text: ="Actividad a realizar"
      Visible: =_crearAgenda
      Width: =350
      X: =43
      Y: =131
- Label_obs_primAct_creaLead:
    Control: Label@2.5.1
    Group: GroupCont2_Form_Prim_Actividad_LeadEnCrea
    Properties:
      BorderColor: =RGBA(0, 18, 107, 1)
      Color: =RGBA(85, 69, 49, 1)
      Font: =Font.'Open Sans'
      FontWeight: =FontWeight.Semibold
      Height: =40
      Size: =20
      Text: ="Observaciones"
      Visible: =_crearAgenda
      Width: =350
      X: =43
      Y: =418
- Button_cancelPrimAct_creaLead:
    Control: Classic/Button@2.2.0
    Group: GroupCont2_Form_Prim_Actividad_LeadEnCrea
    Properties:
      BorderColor: =ColorFade(Self.Fill, -55%)
      BorderThickness: =0
      Color: =RGBA(255, 255, 255, 1)
      DisabledBorderColor: =RGBA(166, 166, 166, 1)
      Fill: |-
        =RGBA(
            _rBotonClaro,
            _gBotonClaro,
            _bBotonClaro,
            _aBotonClaro
        )
      Font: =Font.'Open Sans'
      Height: =50
      HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
      HoverColor: =RGBA(255, 255, 255, 1)
      HoverFill: =Self.Fill
      OnSelect: |
        =Set(
            _crearAgenda,
            false
        );
        Set(
            _primeraAccion,
            Blank()
        );
        //Resetea los campos cuando se devuelve a la vista de creacion Lead
        Reset(TextInp_edit_actReali_creaLead);
        Reset(Select_edit_fechaAct_creaLead);
        Reset(TextInp_editView_obsvAct_creaLead);
      PressedBorderColor: =Self.Fill
      PressedColor: =Self.Fill
      PressedFill: =Self.Color
      RadiusBottomLeft: =30
      RadiusBottomRight: =30
      RadiusTopLeft: =30
      RadiusTopRight: =30
      Size: =16
      Text: ="CANCELAR"
      Visible: '=_crearAgenda '
      Width: =150
      X: =591
      Y: =700
- TextInp_view_fechaAct_creaLead:
    Control: Classic/TextInput@2.3.2
    Group: GroupCont2_Form_Prim_Actividad_LeadEnCrea
    Properties:
      BorderColor: =
      BorderStyle: =BorderStyle.None
      Color: =RGBA(85, 69, 49, 1)
      Default: =
      DelayOutput: =true
      DisplayMode: =DisplayMode.View
      Font: =Font.'Open Sans'
      Height: =57
      HoverBorderColor: =RGBA(0, 18, 107, 1)
      HoverFill: =RGBA(214, 221, 224, 1)
      Mode: =TextMode.MultiLine
      PaddingLeft: =5
      RadiusBottomLeft: =10
      RadiusBottomRight: =10
      RadiusTopLeft: =10
      RadiusTopRight: =10
      Size: =16
      Tooltip: =
      Visible: =_crearAgenda
      Width: =1384
      X: =43
      Y: =346
- Label_fech_primAct_creaLead:
    Control: Label@2.5.1
    Group: GroupCont2_Form_Prim_Actividad_LeadEnCrea
    Properties:
      BorderColor: =RGBA(0, 18, 107, 1)
      Color: =RGBA(85, 69, 49, 1)
      Font: =Font.'Open Sans'
      FontWeight: =FontWeight.Semibold
      Height: =30
      Size: =20
      Text: ="Fecha"
      Visible: =_crearAgenda
      Width: =350
      X: =43
      Y: =295
- TextInp_edit_actReali_creaLead:
    Control: Classic/TextInput@2.3.2
    Group: GroupCont2_Form_Prim_Actividad_LeadEnCrea
    Properties:
      BorderColor: =
      BorderStyle: =BorderStyle.None
      Color: =RGBA(85, 69, 49, 1)
      Default: =_actividadSeleccionada.Anotaciones
      DelayOutput: =true
      DisplayMode: |-
        =If(
            IsBlank(_actividadSeleccionada),
            DisplayMode.Edit,
            _actividadSeleccionada.EstadoSeguimiento.Value = "Pendiente" || _actividadSeleccionada.EstadoSeguimiento.Value = "Vencida",
            DisplayMode.Edit,
            DisplayMode.View
        )
      Font: =Font.'Open Sans'
      Height: =85
      HoverBorderColor: =RGBA(0, 18, 107, 1)
      HoverFill: =RGBA(214, 221, 224, 1)
      Mode: =TextMode.MultiLine
      PaddingLeft: =5
      RadiusBottomLeft: =10
      RadiusBottomRight: =10
      RadiusTopLeft: =10
      RadiusTopRight: =10
      Size: =16
      Tooltip: =
      Visible: =_crearAgenda
      Width: =1384
      X: =45
      Y: =188
- Select_edit_fechaAct_creaLead:
    Control: Classic/DatePicker@2.6.0
    Group: GroupCont2_Form_Prim_Actividad_LeadEnCrea
    Properties:
      BorderColor: =RGBA(0, 18, 107, 1)
      BorderStyle: =BorderStyle.None
      BorderThickness: =0
      Color: =RGBA(85, 69, 49, 1)
      DefaultDate: =_actividadSeleccionada.FechaSeguimiento
      DisplayMode: |-
        =If(
            IsBlank(_actividadSeleccionada),
            DisplayMode.Edit,
            _actividadSeleccionada.EstadoSeguimiento.Value = "Pendiente" || _actividadSeleccionada.EstadoSeguimiento.Value = "Vencida",
            DisplayMode.Edit,
            DisplayMode.View
        )
      Fill: =Color.Transparent
      Font: =Font.'Open Sans'
      Height: =44
      IconBackground: =Color.Transparent
      IconFill: =RGBA(85, 69, 49, 1)
      InputTextPlaceholder: =
      OnChange: |-
        =// Solo validar si hay una fecha seleccionada (no es Blank)
        If(
            !IsBlank(Self.SelectedDate),
            If(
                _primeraAccion = 1 || _nuevaAgenda || (!IsBlank(_actividadSeleccionada) && _actividadSeleccionada.EstadoSeguimiento.Value = "Pendiente"),
                // Solo validar fechas para nueva agenda o primera acción
                If(
                    Select_edit_fechaAct_creaLead.SelectedDate < Today(),
                    Notify(
                        "⚠ Fecha no válida: Solo se permiten fechas desde hoy (" & Text(
                            Today(),
                            "dd/mm/yyyy"
                        ) & ") en adelante.",
                        NotificationType.Error,
                        6000
                    ) && Reset(Self) && Set(
                        _fechaActivaSseleccionada,
                        Blank()
                    ),
                    Set(
                        _fechaActivaSseleccionada,
                        Self.SelectedDate
                    )
                ),
            // Si no es primera acción ni nueva agenda, asignar directamente
                Set(
                    _fechaActivaSseleccionada,
                    Self.SelectedDate
                )
            ),
        // Si la fecha está en blanco (reset), limpiar la variable
            Set(
                _fechaActivaSseleccionada,
                Blank()
            )
        )
      Size: =16
      Visible: |-
        =

        _crearAgenda
      Width: =1346
      X: =58
      Y: =353
- TextInp_editView_obsvAct_creaLead:
    Control: Classic/TextInput@2.3.2
    Group: GroupCont2_Form_Prim_Actividad_LeadEnCrea
    Properties:
      BorderColor: =
      BorderStyle: =BorderStyle.None
      Default: =_actividadSeleccionada.Observaciones
      DelayOutput: =true
      DisplayMode: |-
        =If(
            IsBlank(_actividadSeleccionada),
            DisplayMode.Edit,
            _actividadSeleccionada.EstadoSeguimiento.Value = "Pendiente" || _actividadSeleccionada.EstadoSeguimiento.Value = "Vencida",
            DisplayMode.Edit,
            DisplayMode.View
        )
      Font: =Font.'Open Sans'
      FontWeight: =FontWeight.Lighter
      Height: =175
      HintText: ="Indicar mas información de la actividad a realizar (Opcional)"
      HoverBorderColor: =RGBA(0, 18, 107, 1)
      HoverFill: =RGBA(214, 221, 224, 1)
      Mode: =TextMode.MultiLine
      PaddingLeft: =5
      RadiusBottomLeft: =15
      RadiusBottomRight: =15
      RadiusTopLeft: =15
      RadiusTopRight: =15
      Size: =16
      Tooltip: =
      Visible: |-
        =

        _crearAgenda
      Width: =1384
      X: =43
      Y: =479
- Button_edit_save_FirstAct_leadCreado:
    Control: Classic/Button@2.2.0
    Group: GroupCont2_Form_Prim_Actividad_LeadEnCrea
    Properties:
      BorderColor: =ColorFade(Self.Fill, -55%)
      BorderThickness: =0
      Color: =RGBA(255, 255, 255, 1)
      DisabledBorderColor: =RGBA(166, 166, 166, 1)
      Fill: =RGBA(104, 110, 72, 1)
      Font: =Font.'Open Sans'
      Height: =50
      HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
      HoverColor: =RGBA(255, 255, 255, 1)
      HoverFill: =Self.Fill
      OnSelect: |
        =// CREAR LEAD + PRIMERA AGENDA (Actividad) SIMULTÁNEAMENTE (PATRÓN ORIGINAL)
        // Hacer visible spiner para carga 
        Set(
            _spinner,
            true
        );
        // 1. VALIDACIONES DE CAMPOS DE ACTIVIDAD
        If(
            _nuevaAgenda,
            If(
                IsBlank(TextInp_edit_actReali_creaLead.Text),
                Notify(
                    "El campo de acciones debe estar diligenciado",
                    NotificationType.Warning,
                    6000
                ),
                IsBlank(Select_edit_fechaAct_creaLead.SelectedDate),
                Notify(
                    "Debe seleccionar una fecha de seguimiento",
                    NotificationType.Warning,
                    6000
                ),
                // 2. CREAR CUENTA EN tab_cuentas (NUEVO MODELO RELACIONAL)
                Set(
                    _itemSeleccionadoLead,
                    Patch(
                        tab_cuentas,
                        Defaults(tab_cuentas),
                        {
                            NIT: TextInp_editView_nitClient_creaLeads.Text,
                            RazonSocial: TextInp_razon_social_creaLeads.Text,
                            EstadoCuenta: {Value: "Lead"},
                            FechaCreacionLead: Now(),
                            Ciudad: {
                                Id: Select_edit_ciudades_creaLeads.Selected.ID,
                                Value: Select_edit_ciudades_creaLeads.Selected.Ciudad0
                            },
                            Segmento: {
                                Id: Select_edit_segmento_creaLeads.Selected.ID,
                                Value: Select_edit_segmento_creaLeads.Selected.segmento
                            },
                            Subsegmento: {
                                Id: Select_edit_subsegmento_creaLeads.Selected.ID,
                                Value: Select_edit_subsegmento_creaLeads.Selected.sub_segmento
                            },
                            EstadoNegociacion: {
                                Id: 1,
                                Value: "Lead"
                            },
                            Canal: {
                                Id: _canalComercial.canal_relacionado.Id,
                                Value: TextInp_view_canalCom_creaLeads.Text
                            },
                            ComercialAsignado: {
                                '@odata.type': "#Microsoft.Azure.Connectors.SharePoint.SPListExpandedUser",
                                Claims: "i:0#.f|membership|" & _infoUsuarioLoggeado.Email,
                                Department: "",
                                DisplayName: _infoUsuarioLoggeado.FullName,
                                Email: _infoUsuarioLoggeado.Email,
                                JobTitle: "",
                                Picture: ""
                            },
                            NombreContacto: TextInp_editView_nombreCont_creaLeads.Text,
                            ApellidosContacto: TextInp_editView_apellidosCont_creaLeads.Text,
                            CargoContacto: TextInp_editView_cargoCont_creaLeads.Text,
                            EmailContacto: TextInp_editView_emailCont_creaLeads.Text,
                            estado_interes: {Value: _interesSeleccionadoLead},
                            RequiereCredito: false,
                            RequiereDocumentos: _requiereDocumentos,
                            CarpetaCreada: false,
                            DocumentosAprobadosBackOffice: false,
                            DocumentosAprobadosFinanzas: false,
                            Status_cuenta: {Value: "Inactivo"}
                        }
                    )
                );
                // 3. INICIALIZACION Y DECLARACION DE VARIABLES PARA USO POSTERIOR
        Set(
                    _cuentaCreada,
                    _itemSeleccionadoLead
                );
                //variable relacionada a los datos del lead creado
        // variable lead creado
        Set(
                    _leadCreado,
                    true
                );
                //guardar estado de lead
        Set(
                    _estadoSeleccionadoLead,
                    "Lead"
                );
                // 4. CREAR PRIMERA ACTIVIDAD EN tab_seguimiento_porCuenta
        Patch(
                    tab_seguimiento_porCuenta,
                    Defaults(tab_seguimiento_porCuenta),
                    {
                        Anotaciones: TextInp_edit_actReali_creaLead.Text,
                        Observaciones: TextInp_editView_obsvAct_creaLead.Text,
                        Cuenta: {
                            Id: _itemSeleccionadoLead.ID,
                            Value: _itemSeleccionadoLead.RazonSocial
                        },
                        FechaSeguimiento: Select_edit_fechaAct_creaLead.SelectedDate,
                        EstadoCuentaEnSeguimiento: {Value: "Lead"},
                        ComercialResponsable: {
                            '@odata.type': "#Microsoft.Azure.Connectors.SharePoint.SPListExpandedUser",
                            Claims: "i:0#.f|membership|" & _infoUsuarioLoggeado.Email,
                            Department: "",
                            DisplayName: _infoUsuarioLoggeado.FullName,
                            Email: _infoUsuarioLoggeado.Email,
                            JobTitle: "",
                            Picture: ""
                        },
                        EstadoSeguimiento: {Value: "Pendiente"},
                        RequiereAccion: true
                    }
                );
                // 5. REGISTRO DE LEAD CREADO EN HISTÓRICO tab_hist_cambioEstd_cuenta
        Patch(
                    tab_hist_cambioEstd_cuenta,
                    Defaults(tab_hist_cambioEstd_cuenta),
                    {
                        Cuenta: {
                            Id: _itemSeleccionadoLead.ID,
                            Value: _itemSeleccionadoLead.RazonSocial
                        },
                        EstadoAnterior: {Value: "Lead"},
                        EstadoNuevo: {Value: Blank()},
                        UsuarioResponsable: {
                            '@odata.type': "#Microsoft.Azure.Connectors.SharePoint.SPListExpandedUser",
                            Claims: "i:0#.f|membership|" & _infoUsuarioLoggeado.Email,
                            Department: "",
                            DisplayName: _infoUsuarioLoggeado.FullName,
                            Email: _infoUsuarioLoggeado.Email,
                            JobTitle: "",
                            Picture: ""
                        }
                    }
                );
                //coleccion leads creados
        ClearCollect(
                    colLeads,
                    Filter(
                        tab_cuentas,
                        ComercialAsignado.Email = _correoLoggeado
                    )
                );
                // 6. RESET FORMULARIO DE ACTIVIDAD
        Set(
                    _crearAgenda,
                    false
                );
                Reset(TextInp_edit_actReali_creaLead);
                Reset(TextInp_editView_obsvAct_creaLead);
                Reset(Select_edit_fechaAct_creaLead);
                Set(
                    _primeraAccion,
                    0
                );
                Set(
                    _actividadSeleccionada,
                    Blank()
                );
                Set(
                    _spinner,
                    false
                );
                Notify(
                    "✓ Lead y actividad creados exitosamente",
                    NotificationType.Success,
                    6000
                )
            )
        )
      PressedBorderColor: =Self.Fill
      PressedColor: =Self.Fill
      PressedFill: =Self.Color
      RadiusBottomLeft: =30
      RadiusBottomRight: =30
      RadiusTopLeft: =30
      RadiusTopRight: =30
      Size: =16
      Text: ="GUARDAR"
      Visible: =_primeraAccion = 1
      Width: =150
      X: =772
      Y: =702
- TextCanvas_edit_Explain_primAct_creaLead:
    Control: Text@0.0.51
    Group: GroupCont2_Form_Prim_Actividad_LeadEnCrea
    Properties:
      FontColor: =RGBA(184, 0, 0, 1)
      Size: =20
      Text: ="Es necesario crear una agenda para finalizar la creación del lead; de lo contrario, no se podrá completar el proceso."
      Visible: =_primeraAccion = 1
      Width: =1070
      X: =226
      Y: =779
